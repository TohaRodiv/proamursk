{% extends "site/base.html" %}
{% load static static_version %}
{% load utils_tags media_filters site_tags %}

{% block title %}
    {% if content_page %}
        {{ content_page.meta_title|default:content_page.name }}
    {% endif %}
{% endblock %}

{% block seo %}
    <meta name="keywords" content="{{ content_page.meta_keywords }}">
    <meta name="description" content="{{ content_page.meta_description }}">
{% endblock %}

{% block og %}
    {% if content_page %}
        {% og_meta_tags og_title=content_page.meta_title|default:content_page.name og_description=content_page.meta_description og_image=content_page.og_image|get_thumbnail_url_by_name:"og_image_default" %}
    {% endif %}
{% endblock %}


{% block content %}
    <main class="light-bg">
        <div class="container">
            <div class="index-manage-row">
                {% for top_item in top_objects %}
                    {% if forloop.counter == 1 %}
                        {% with item=top_item.get_object css_class='grid-publication_6-col' first_item=True cover_name="6_column_img_full" %}
                            {% if item %}
                                {% if top_item.entity == 'event-announcements' or top_item.entity == 'reports' %}
                                    {% include "site/modules/grid-event.html" %}
                                {% else %}
                                    {% include "site/modules/grid-publication.html" %}
                                {% endif %}
                            {% else %}
                                <div class="grid-publication-placeholder"></div>
                            {% endif %}
                        {% endwith %}
                    {% else %}
                        {% with item=top_item.get_object %}
                            {% if item %}
                                {% with cover_name="3_column_img_"|add:item.cover_format %}
                                    {% if top_item.entity == 'event-announcements' or top_item.entity == 'reports' %}
                                        {% include "site/modules/grid-event.html" %}
                                    {% else %}
                                        {% include "site/modules/grid-publication.html" %}
                                    {% endif %}
                                {% endwith %}
                            {% else %}
                                <div class="grid-publication-placeholder"></div>
                            {% endif %}
                        {% endwith %}
                    {% endif %}
                {% endfor %}
            </div>

            <div class="index-selection">
                <div class="selection-head_index">
                    <p class="selection-head__subtitle icon-crown">Самое главное</p>
                    <h2 class="selection-head__title"><a href="selection.html">День Металлурга «Амурский драйв»</a></h2>
                </div>

                <div class="index-selection-grid">
                    {% for top_item in top_objects %}
                        {% with item=top_item.get_object %}
                            {% if item %}
                                {% with cover_name="3_column_img_"|add:item.cover_format %}
                                    {% if top_item.entity == 'event-announcements' or top_item.entity == 'reports' %}
                                        {% include "site/modules/grid-event.html" %}
                                    {% else %}
                                        {% include "site/modules/grid-publication.html" %}
                                    {% endif %}
                                {% endwith %}
                            {% endif %}
                        {% endwith %}
                    {% endfor %}
                </div>

                {% if i > 4 %}
                    <div class="index-selection__link-wrap">
                        <a href="selection.html" class="btn btn_blue btn_size_big index-selection__link">Все материалы (5)</a>
                    </div>
                {% endif %}
            </div>

            <div class="index-manage-row">
                {% for top_item in top_objects %}
                    {% with item=top_item.get_object %}
                        {% if item %}
                            {% with cover_name="3_column_img_"|add:item.cover_format %}
                                {% if top_item.entity == 'event-announcements' or top_item.entity == 'reports' %}
                                    {% include "site/modules/grid-event.html" %}
                                {% else %}
                                    {% include "site/modules/grid-publication.html" %}
                                {% endif %}
                            {% endwith %}
                        {% else %}
                            <div class="grid-publication-placeholder"></div>
                        {% endif %}
                    {% endwith %}
                {% endfor %}
            </div>
        </div>

        {% if content_blocks.show_banner.content and wide_banner %}
            <a href="" class="layout-section container banner">
                <img src="{{ wide_banner.cover|get_thumbnail_url_by_name:"wide_banner" }}" alt="" class="banner__img">
            </a>
        {% else %}
            <div class="layout-section slider full-width-slider">
                <div class="slider-container">
                    {% for item in specials %}
                        <div class="slide">
                            {% with cover_name="specials_index" class="grid-publication_full-width-slider" %}
                                {% include "site/modules/special-project.html" %}
                            {% endwith %}
                        </div>
                    {% endfor %}
                </div>
                <div class="slider-circles-container"></div>
                {%  if specials|length > 1 %}
                    <div class="slider-arrow-container">
                        <button class="slider-arrow slider-arrow-prev slider-arrow_round icon-arrow-left active"></button>
                        <button class="slider-arrow slider-arrow-next slider-arrow_round icon-arrow-right active"></button>
                    </div>
                {% endif %}
            </div>
        {% endif %}

        <div class="container layout-section">
            <h2 class="section__title">ЧЕМ ЗАНЯТЬСЯ В АМУРСКЕ?</h2>
            <div class="todo-layout">
                {% include "site/page-block/cinema-widget.html" %}

                {% for item in what_to_do %}
                    {% if item %}
                        {% if forloop.counter == 1 %}
                            {% with css_class="grid-publication_6-col" model_name=item|get_model_name cover_name="6_column_img_"|add:item.cover_format %}
                                {% if model_name == 'event' or model_name == 'report' %}
                                    {% include "site/modules/grid-event.html" %}
                                {% else %}
                                    {% include "site/modules/grid-publication.html" %}
                                {% endif %}
                            {% endwith %}
                        {% else %}
                            {% with model_name=item|get_model_name cover_name="3_column_img_"|add:item.cover_format %}
                                {% if model_name == 'event' or model_name == 'report' %}
                                    {% include "site/modules/grid-event.html" %}
                                {% else %}
                                    {% include "site/modules/grid-publication.html" %}
                                {% endif %}
                            {% endwith %}
                        {% endif %}
                    {% endif %}
                {% endfor %}
            </div>
        </div>
    </main>
{% endblock %}

{% block additional_content %}
    {% read_also %}
{% endblock %}
